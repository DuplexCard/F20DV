<meta charset="utf-8">
<div id="my_dataviz"></div>
<div id="my_dataviz2"></div>



<!-- Load d3.js -->
<script src="https://d3js.org/d3.v7.js"></script>


<script>




// Define the data
const data2 = [
  {Date: '2021-09-25', Country: 'OWID_LIC', Value: 10},
  {Date: '2021-09-25', Country: 'OWID_HIC', Value: 1},
  {Date: '2021-09-26', Country: 'OWID_LIC', Value: 12},
  {Date: '2021-09-26', Country: 'OWID_HIC', Value: 3}
];

const data3 = [
  {Date: '2021-09-25', Country: 'OWID_LIC', Value: 1},
  {Date: '2021-09-25', Country: 'OWID_HIC', Value: 2},
  {Date: '2021-09-26', Country: 'OWID_LIC', Value: 2},
  {Date: '2021-09-26', Country: 'OWID_HIC', Value: 1}
];

const data = Object.values(data2.reduce((acc, curr) => {
  const { Date, Country, Value } = curr;
  if (acc[Date]) {
    acc[Date][Country] = Value;
  } else {
    acc[Date] = { Date, [Country]: Value };
  }
  return acc;
}, {}));


const dataD = Object.values(data3.reduce((acc, curr) => {
  const { Date, Country, Value } = curr;
  if (acc[Date]) {
    acc[Date][Country] = Value;
  } else {
    acc[Date] = { Date, [Country]: Value };
  }
  return acc;
}, {}));


// Define the width, height, and margins for the chart
const width = 600;
const height = 400;
const margin = { top: 20, right: 20, bottom: 30, left: 40 };

// Create the SVG element
const svg = d3.select("body")
  .append('svg')
  .attr('width', width)
  .attr('height', height);

// Define the x and y scales
const x = d3.scaleBand()
  .domain(data.map(d => d.Date))
  .range([margin.left, width - margin.right])
  .padding(0.1);

const y = d3.scaleLinear()
  .domain([0, d3.max(data, d => d.OWID_LIC + d.OWID_HIC)])
  .nice()
  .range([height - margin.bottom, margin.top]);

// Define the color scale
const color = d3.scaleOrdinal()
  .domain(Object.keys(data[0]).slice(1))
  .range(d3.schemeCategory10);
// Add the bars to the chart

// Add the bars to the chart
const bars = svg.append('g')
  .selectAll('g')
  .data(d3.stack().keys(Object.keys(data[0]).slice(1))(data))
  .join('g')
    .attr('fill', d => color(d.key))
  .selectAll('rect')
  .data(d => d)
  .join('rect')
    .attr('x', d => x(d.data.Date))
    .attr('y', d => y(d[1]))
    .attr('height', d => y(d[0]) - y(d[1]))
    .attr('width', x.bandwidth())
    .on('mouseenter', function (event, d) {
      // Select all bars with the same group key and update their fill color
      const groupKey = d3.select(this.parentNode).datum().key;
   var v = color(groupKey)
      d3.selectAll(`g[fill="${color(groupKey)}"`)
        .style("opacity", 10)
        .style("stroke", v)
        .style("stroke-width", 10)
    })
    .on('mouseleave', function (event, d) {
      // Select all bars with the same group key and update their fill color
      const groupKey = d3.select(this.parentNode).datum().key;
      
      d3.selectAll(`g`)
      .style("stroke", "transparent")
      .style("opacity", 1)
    
    });
// Add the x-axis to the chart
svg.append('g')
  .attr('transform', `translate(0, ${height - margin.bottom})`)
  .call(d3.axisBottom(x));

// Add the y-axis to the chart
svg.append('g')
  .attr('transform', `translate(${margin.left}, 0)`)
  .call(d3.axisLeft(y));
// Add a legend to the chart
const legend = svg.append('g')
  .attr('transform', `translate(${width - margin.right - 120}, ${margin.top})`)
  .attr('text-anchor', 'end')
  .attr('font-size', 10)
  .selectAll('g')
  .data(color.domain().slice().reverse())
  .join('g')
    .attr('transform', (d, i) => `translate(0, ${i * 20})`);

legend.append('rect')
  .attr('x', -19)
  .attr('width', 19)
  .attr('height', 19)
  .attr('fill', color);

legend.append('text')
  .attr('x', -24)
  .attr('y', 9.5)
  .attr('dy', '0.35em')
  .text(d => d);






/////////////////////////////////////////////////////////////////
var tooltip = d3.select("#my_dataviz")
    .append("div")
    .style("opacity", 0)
    .attr("class", "tooltip")
    .style("background-color", "white")
    .style("border", "solid")
    .style("border-width", "1px")
    .style("border-radius", "5px")
    .style("padding", "10px")


console.log(dataD)


// Create the SVG element
const svg2 = d3.select('#my_dataviz')
  .append('svg')
  .attr('width', width)
  .attr('height', height);

// Define the x and y scales
const x2 = d3.scaleBand()
  .domain(dataD.map(d => d.Date))
  .range([margin.left, width - margin.right])
  .padding(0.1);

const y2 = d3.scaleLinear()
  .domain([0, d3.max(dataD, d => d.OWID_LIC + d.OWID_HIC)])
  .nice()
  .range([height - margin.bottom, margin.top]);

// Define the color scale
const color2 = d3.scaleOrdinal()
  .domain(Object.keys(dataD[0]).slice(1))
  .range(d3.schemeCategory10);
// Add the bars to the chart

// Add the bars to the chart
const bars2 = svg2.append('g')
  .selectAll('g')
  .data(d3.stack().keys(Object.keys(dataD[0]).slice(1))(dataD))
  .join('g')
    .attr('fill', d => color(d.key))
  .selectAll('rect')
  .data(d => d)
  .join('rect')
    .attr('x', d => x(d.data.Date))
    .attr('y', d => y(d[1]))
    .attr('height', d => y(d[0]) - y(d[1]))
    .attr('width', x.bandwidth())
    .on('mouseenter', function (event, d) {
      // Select all bars with the same group key and update their fill color
      const groupKey = d3.select(this.parentNode).datum().key;
      //d3.selectAll("g").style("opacity", 0.8)
      var v = color(groupKey)
      d3.selectAll(`g[fill="${color(groupKey)}"`)
        .style("opacity", 10)
        .style("stroke", v)
        .style("stroke-width", 10)

        const subgroupValue = d.data[groupKey];


    })

    .on('movemove', function (event, d){
      const mousemove = function(event, d) {

  }

    })
    .on('mouseleave', function (event, d) {
      // Select all bars with the same group key and update their fill color
      const groupKey = d3.select(this.parentNode).datum().key;
      
      d3.selectAll(`g`)
      .style("stroke", "transparent")
      .style("opacity", 1)


    });
// Add the x-axis to the chart
svg2.append('g')
  .attr('transform', `translate(0, ${height - margin.bottom})`)
  .call(d3.axisBottom(x));

// Add the y-axis to the chart
svg2.append('g')
  .attr('transform', `translate(${margin.left}, 0)`)
  .call(d3.axisLeft(y));
  /*
// Add a legend to the chart
const legend2 = svg2.append('g')
  .attr('transform', `translate(${width - margin.right - 120}, ${margin.top})`)
  .attr('text-anchor', 'end')
  .attr('font-size', 10)
  .selectAll('g')
  .data(color.domain().slice().reverse())
  .join('g')
    .attr('transform', (d, i) => `translate(0, ${i * 20})`);

legend2.append('rect')
  .attr('x', -19)
  .attr('width', 19)
  .attr('height', 19)
  .attr('fill', color);

legend2.append('text')
  .attr('x', -24)
  .attr('y', 9.5)
  .attr('dy', '0.35em')
  .text(d => d);
*/
  </script>
  
